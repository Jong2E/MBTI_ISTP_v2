<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTP ìƒë‹´ - ë¬´ì—‡ì´ë“  ì§ˆë¬¸í•˜ì„¸ìš”</title>
<parameter name="description" content="ISTPì— ëŒ€í•œ ê¶ê¸ˆí•œ ì ì„ ììœ ë¡­ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”">
    
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=Nanum+Pen+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* ë”°ëœ»í•œ ë² ì´ì§€ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
            --primary-warm: #D4A574;
            --secondary-warm: #E6C2A6;
            --accent-gold: #DAA520;
            --accent-bronze: #CD7F32;
            --text-dark: #5D4037;
            --text-medium: #8D6E63;
            --text-light: #BCAAA4;
            --paper-bg: #FFFbF7;
            --paper-shadow: 0 8px 32px rgba(139, 69, 19, 0.15);
            --bg-gradient-start: #FFF8E1;
            --bg-gradient-end: #F3E5AB;
            --card-bg: rgba(255, 248, 225, 0.95);
            --shadow-light: 0 4px 12px rgba(139, 69, 19, 0.15);
            --shadow-heavy: 0 8px 24px rgba(139, 69, 19, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
            position: relative;
        }

        /* ë°°ê²½ ë§ˆë²• íš¨ê³¼ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 224, 130, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 183, 77, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .main-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* í—¤ë” */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 248, 225, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(139, 69, 19, 0.1);
            z-index: 100;
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-button {
            background: var(--secondary-warm);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: var(--primary-warm);
            transform: scale(1.1);
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            flex: 1;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .content-wrapper {
            margin-top: 80px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        /* ì†Œì› í¸ì§€ì§€ */
        .wish-paper {
            background: var(--paper-bg);
            border-radius: 20px;
            box-shadow: var(--paper-shadow);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            position: relative;
            border: 2px solid var(--secondary-warm);
            transition: all 0.3s ease;
        }

        .wish-paper::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--accent-gold), var(--primary-warm));
            border-radius: 25px;
            z-index: -1;
            opacity: 0.3;
        }

        .paper-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .paper-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .magic-icon {
            color: var(--accent-gold);
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        .paper-subtitle {
            font-size: 16px;
            color: var(--text-medium);
            font-style: italic;
        }

        /* ì§ˆë¬¸ ì…ë ¥ ì˜ì—­ */
        .question-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .question-textarea {
            width: 100%;
            min-height: 200px;
            max-height: 300px;
            padding: 20px;
            border: 2px solid var(--secondary-warm);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.8);
            font-family: 'Nanum Pen Script', cursive;
            font-size: 18px;
            color: var(--text-dark);
            resize: vertical;
            outline: none;
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .question-textarea:focus {
            border-color: var(--accent-gold);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 20px rgba(218, 165, 32, 0.3);
        }

        .question-textarea::placeholder {
            color: var(--text-light);
            font-style: italic;
        }

        /* ì†Œì› ë³´ë‚´ê¸° ë²„íŠ¼ */
        .send-wish-button {
            background: linear-gradient(135deg, var(--accent-gold), var(--primary-warm));
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .send-wish-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .send-wish-button:hover::before {
            left: 100%;
        }

        .send-wish-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(218, 165, 32, 0.4);
        }

        .send-wish-button:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 248, 225, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        .loading-content {
            text-align: center;
            padding: 40px;
            background: var(--paper-bg);
            border-radius: 20px;
            box-shadow: var(--paper-shadow);
            border: 2px solid var(--secondary-warm);
            max-width: 400px;
            margin: 0 20px;
        }

        .loading-icon {
            font-size: 60px;
            color: var(--accent-gold);
            margin-bottom: 20px;
            animation: magicSpin 2s infinite;
        }

        @keyframes magicSpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .loading-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .loading-subtext {
            font-size: 14px;
            color: var(--text-medium);
            font-style: italic;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--secondary-warm);
            border-radius: 3px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-gold), var(--primary-warm));
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ë‹µë³€ ì˜ì—­ */
        .answer-section {
            display: none;
            width: 100%;
            max-width: 500px;
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .answer-paper {
            background: linear-gradient(135deg, var(--paper-bg) 0%, #FFF 100%);
            border-radius: 20px;
            box-shadow: var(--paper-shadow);
            padding: 40px;
            position: relative;
            border: 2px solid var(--accent-gold);
        }

        .answer-paper::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--accent-gold), var(--wish-purple));
            border-radius: 25px;
            z-index: -1;
            opacity: 0.5;
        }

        .answer-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .answer-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .answer-content {
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        /* ë‹µë³€ ë‚´ìš© êµ¬ì¡°í™” ìŠ¤íƒ€ì¼ */
        .answer-content p {
            margin-bottom: 16px;
            padding: 0;
        }

        .answer-content strong {
            color: var(--accent-bronze);
            font-weight: 600;
        }

        .answer-content em {
            color: var(--text-medium);
            font-style: italic;
        }

        /* ë¦¬ìŠ¤íŠ¸ í•­ëª© ìŠ¤íƒ€ì¼ë§ */
        .answer-content .point-list {
            background: rgba(255, 248, 225, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border: 1px solid var(--secondary-warm);
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);
        }

        .answer-content .point-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .answer-content .point-item:last-child {
            margin-bottom: 0;
        }

        .answer-content .point-icon {
            color: var(--accent-gold);
            font-size: 14px;
            margin-top: 3px;
            flex-shrink: 0;
        }

        .answer-content .point-text {
            flex: 1;
            font-size: 15px;
            line-height: 1.6;
        }

        /* ì„¹ì…˜ ì œëª© ìŠ¤íƒ€ì¼ */
        .answer-content .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin: 24px 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary-warm);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .answer-content .section-title .section-icon {
            color: var(--accent-gold);
            font-size: 16px;
        }

        /* í•˜ì´ë¼ì´íŠ¸ ë°•ìŠ¤ */
        .answer-content .highlight-box {
            background: linear-gradient(135deg, rgba(218, 165, 32, 0.1), rgba(212, 165, 116, 0.1));
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
            font-weight: 500;
        }

        /* ì¸ì‚¬ë§ ë° ë§ˆë¬´ë¦¬ */
        .answer-content .greeting,
        .answer-content .closing {
            text-align: center;
            font-style: italic;
            color: var(--text-medium);
            margin: 20px 0;
        }

        .answer-content .greeting {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 24px;
        }

        .answer-content .closing {
            margin-top: 24px;
            padding: 16px;
            background: rgba(255, 248, 225, 0.5);
            border-radius: 8px;
        }

        .answer-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-button {
            background: var(--secondary-warm);
            color: var(--text-dark);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-button:hover {
            background: var(--primary-warm);
            transform: translateY(-2px);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 480px) {
            .main-container {
                padding: 15px;
            }

            .wish-paper,
            .answer-paper {
                padding: 25px;
            }

            .paper-title {
                font-size: 24px;
            }

            .question-textarea {
                min-height: 160px;
                max-height: 250px;
                padding: 15px;
                font-size: 16px;
            }

            .send-wish-button {
                padding: 15px 30px;
                font-size: 16px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content">
            <button class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="header-title">ISTPì—ê²Œ ì§ˆë¬¸í•˜ê¸°</div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-container">
        <div class="content-wrapper">
            <!-- ì†Œì› í¸ì§€ì§€ -->
            <div class="wish-paper" id="wishPaper">
                <div class="paper-header">
                    <h1 class="paper-title">
                        <i class="fas fa-star magic-icon"></i>
                        ISTPì— ëŒ€í•´<br>ë¬´ì—‡ì´ë“  ë¬¼ì–´ë´!
                        <i class="fas fa-star magic-icon"></i>
                    </h1>
                    <p class="paper-subtitle">ISTPì—ê²Œ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?<br>í‰ì†Œì— ISTPì— ëŒ€í•´ ì•Œê³  ì‹¶ì—ˆë˜ ì ì„ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.</p>
                </div>

                <form class="question-form" onsubmit="sendWish(event)">
                    <label class="form-label">
                        <i class="fas fa-feather-alt"></i>
                        ë¬´ì—‡ì´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?
                    </label>
                    <textarea 
                        class="question-textarea" 
                        id="questionInput"
                        placeholder="ISTPì— ëŒ€í•´ ê¶ê¸ˆí•œ ê²ƒì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;â€¢ ISTPì˜ ì—°ì•  ìŠ¤íƒ€ì¼ì€ ì–´ë–¤ê°€ìš”?&#10;â€¢ ISTPì—ê²Œ ë§ëŠ” ì§ì—…ì€ ë¬´ì—‡ì¸ê°€ìš”?&#10;â€¢ ISTPì˜ ì¥ë‹¨ì ì„ ì•Œê³  ì‹¶ì–´ìš”&#10;â€¢ ISTPì™€ ì˜ ë§ëŠ” ì„±ê²© ìœ í˜•ì€?"
                        required
                        maxlength="500"
                    ></textarea>
                    
                    <button type="submit" class="send-wish-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                        ì§ˆë¬¸í•˜ê¸°
                    </button>
                </form>
            </div>

            <!-- ë‹µë³€ ì˜ì—­ -->
            <div class="answer-section" id="answerSection">
                <div class="answer-paper">
                    <div class="answer-header">
                        <h2 class="answer-title">
                            <i class="fas fa-envelope-open-text"></i>
                            ë‹¹ì‹ ì„ ìœ„í•œ ë‹µë³€ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤
                        </h2>
                    </div>
                    <div class="answer-content" id="answerContent">
                        <!-- ë‹µë³€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                    <div class="answer-actions">
                        <button class="action-button" onclick="newWish()">
                            <i class="fas fa-plus"></i>
                            ìƒˆë¡œìš´ ì§ˆë¬¸
                        </button>
                        <button class="action-button" onclick="goBack()">
                            <i class="fas fa-home"></i>
                            ì²˜ìŒìœ¼ë¡œ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon">
                <i class="fas fa-magic"></i>
            </div>
            <div class="loading-text">ë§ˆë²•ì´ ë‹µì„ ì°¾ê³  ìˆì–´ìš”...</div>
            <div class="loading-subtext">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” âœ¨</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript - deferë¡œ ìˆœì„œ ë³´ì¥ -->
    <script src="js/config.js" defer></script>
    <script src="js/istp-knowledge-base.js" defer></script>
    <script src="js/personalization.js" defer></script>
    <script src="js/gemini-api.js" defer></script>
    <script>
        class ISTPWishService {
            constructor() {
                this.chatbotGender = localStorage.getItem('userGender') || 'male';
                this.loadingMessages = [
                    "ISTPì˜ ë¹„ë°€ì„ ì°¾ê³  ìˆì–´ìš”...",
                    "ë…¼ë¦¬ì ì¸ ë‹µë³€ì„ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”...",
                    "ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ë§Œë“¤ì–´ë‚´ê³  ìˆì–´ìš”...",
                    "ë‹¹ì‹ ë§Œì„ ìœ„í•œ ë§ì¶¤ ë‹µë³€ì„ ì‘ì„± ì¤‘...",
                    "ë§ˆë²•ì˜ ì§€ì‹ì°½ê³ ë¥¼ ë’¤ì ì´ê³  ìˆì–´ìš”..."
                ];
                
                this.init();
            }

            init() {
                this.checkGenderSelection();
                this.setupTextareaAutoResize();
            }

            checkGenderSelection() {
                if (!this.chatbotGender) {
                    window.location.href = 'gender-selection.html';
                    return;
                }
            }

            setupTextareaAutoResize() {
                const textarea = document.getElementById('questionInput');
                textarea.addEventListener('input', () => {
                    textarea.style.height = 'auto';
                    textarea.style.height = Math.min(textarea.scrollHeight, 350) + 'px';
                });
            }

            async sendWish(event) {
                event.preventDefault();
                
                const questionInput = document.getElementById('questionInput');
                const question = questionInput.value.trim();
                
                if (!question) {
                    alert('ì§ˆë¬¸ì„ ì ì–´ì£¼ì„¸ìš”! ğŸ˜Š');
                    return;
                }

                // UI ìƒíƒœ ë³€ê²½
                this.showLoading();
                
                try {
                    // 12ì´ˆ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜
                    await this.simulateLoading();
                    
                    // getGeminiResponse í•¨ìˆ˜ê°€ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
                    while (typeof getGeminiResponse === 'undefined') {
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    // API í˜¸ì¶œ
                    const answer = await getGeminiResponse(question, this.chatbotGender);
                    
                    // ë‹µë³€ í‘œì‹œ
                    this.showAnswer(question, answer);
                    
                } catch (error) {
                    console.error('Error:', error);
                    this.showAnswer(question, this.getFallbackAnswer(question));
                } finally {
                    this.hideLoading();
                }
            }

            showLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = 'flex';
                
                // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì• ë‹ˆë©”ì´ì…˜
                this.animateProgress();
                
                // ë¡œë”© ë©”ì‹œì§€ ë³€ê²½
                this.rotateLoadingMessages();
            }

            async animateProgress() {
                const progressFill = document.getElementById('progressFill');
                const duration = 12000; // 12ì´ˆ
                const steps = 100;
                const stepDuration = duration / steps;
                
                for (let i = 0; i <= steps; i++) {
                    progressFill.style.width = `${i}%`;
                    await new Promise(resolve => setTimeout(resolve, stepDuration));
                }
            }

            rotateLoadingMessages() {
                const loadingTextElement = document.querySelector('.loading-text');
                let messageIndex = 0;
                
                const interval = setInterval(() => {
                    messageIndex = (messageIndex + 1) % this.loadingMessages.length;
                    loadingTextElement.textContent = this.loadingMessages[messageIndex];
                }, 2400); // 2.4ì´ˆë§ˆë‹¤ ë©”ì‹œì§€ ë³€ê²½
                
                // 12ì´ˆ í›„ ì •ë¦¬
                setTimeout(() => {
                    clearInterval(interval);
                }, 12000);
            }

            async simulateLoading() {
                return new Promise(resolve => {
                    setTimeout(resolve, 12000); // 12ì´ˆ ëŒ€ê¸°
                });
            }

            hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = 'none';
            }

            showAnswer(question, answer) {
                // í¸ì§€ì§€ ìˆ¨ê¸°ê¸°
                const wishPaper = document.getElementById('wishPaper');
                wishPaper.style.display = 'none';
                
                // ë‹µë³€ ì˜ì—­ í‘œì‹œ
                const answerSection = document.getElementById('answerSection');
                const answerContent = document.getElementById('answerContent');
                
                answerContent.innerHTML = this.formatAnswer(answer);
                answerSection.style.display = 'block';
                
                // ìŠ¤í¬ë¡¤ì„ ë‹µë³€ ì˜ì—­ìœ¼ë¡œ
                setTimeout(() => {
                    answerSection.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            }

            formatAnswer(answer) {
                // ë‹µë³€ì„ êµ¬ì¡°í™”ëœ ë ˆì´ì•„ì›ƒìœ¼ë¡œ í¬ë§·íŒ…
                let formattedAnswer = answer;
                
                // ì¸ì‚¬ë§ ê°ì§€ ë° ìŠ¤íƒ€ì¼ë§
                formattedAnswer = formattedAnswer.replace(
                    /(ì•ˆë…•í•˜ì„¸ìš”![^\.]*\.)/g, 
                    '<div class="greeting">$1</div>'
                );
                
                // ì„¹ì…˜ ì œëª© ê°ì§€ ë° ìŠ¤íƒ€ì¼ë§ (**ì œëª©:** í˜•íƒœ)
                formattedAnswer = formattedAnswer.replace(
                    /\*\*([^*]+):\*\*/g,
                    '<div class="section-title"><i class="fas fa-star section-icon"></i>$1</div>'
                );
                
                // ë¦¬ìŠ¤íŠ¸ í•­ëª© ê°ì§€ ë° êµ¬ì¡°í™” (â€¢ ì‹œì‘í•˜ëŠ” í•­ëª©ë“¤)
                formattedAnswer = formattedAnswer.replace(
                    /((?:^|\n)(?:â€¢[^\n]+(?:\n|$))+)/gm,
                    (match) => {
                        const items = match.trim().split('\n').filter(line => line.trim().startsWith('â€¢'));
                        const itemsHtml = items.map(item => {
                            const text = item.replace('â€¢', '').trim();
                            return `<div class="point-item">
                                <i class="fas fa-check-circle point-icon"></i>
                                <span class="point-text">${text}</span>
                            </div>`;
                        }).join('');
                        return `<div class="point-list">${itemsHtml}</div>`;
                    }
                );
                
                // ê°•ì¡° í…ìŠ¤íŠ¸ ì²˜ë¦¬
                formattedAnswer = formattedAnswer.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
                formattedAnswer = formattedAnswer.replace(/\*([^*]+)\*/g, '<em>$1</em>');
                
                // ì§ˆë¬¸ ì¸ìš© í•˜ì´ë¼ì´íŠ¸
                formattedAnswer = formattedAnswer.replace(
                    /"([^"]+)"/g,
                    '<div class="highlight-box">"$1"</div>'
                );
                
                // ë§ˆë¬´ë¦¬ ì¸ì‚¬ ê°ì§€
                formattedAnswer = formattedAnswer.replace(
                    /(ë” êµ¬ì²´ì ì¸[^!]*!.*?[âœ¨ğŸ˜Š]+)/g,
                    '<div class="closing">$1</div>'
                );
                
                // ê¸°ë³¸ ì¤„ë°”ê¿ˆ ì²˜ë¦¬ (ì´ë¯¸ divë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ë¶€ë¶„ë§Œ)
                formattedAnswer = formattedAnswer.replace(/\n/g, '<br>');
                
                // ì—°ì†ëœ br íƒœê·¸ë¥¼ paragraphë¡œ ë³€í™˜
                formattedAnswer = formattedAnswer.replace(/<br>\s*<br>/g, '</p><p>');
                
                // ì „ì²´ë¥¼ paragraphë¡œ ê°ì‹¸ê¸° (ì´ë¯¸ divê°€ ì•„ë‹Œ ê²½ìš°ë§Œ)
                if (!formattedAnswer.includes('<div')) {
                    formattedAnswer = `<p>${formattedAnswer}</p>`;
                }
                
                return formattedAnswer;
            }

            getFallbackAnswer(question) {
                const genderText = this.chatbotGender === 'female' ? 'ì—¬ì„±' : 'ë‚¨ì„±';
                
                return `ì•ˆë…•í•˜ì„¸ìš”! ${genderText} ISTP ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ğŸŒŸ

ê·€í•˜ì˜ ì§ˆë¬¸ì„ ë°›ì•˜ìŠµë‹ˆë‹¤: "${question}"

ISTPëŠ” ë…¼ë¦¬ì ì´ê³  ì‹¤ìš©ì ì¸ ì„±ê²©ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤:

**ì£¼ìš” íŠ¹ì„±:**
â€¢ ë›°ì–´ë‚œ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥
â€¢ ë…ë¦½ì ì´ê³  ììœ ë¡œìš´ ì„±í–¥  
â€¢ í˜„ì‹¤ì ì´ê³  ì‹¤ìš©ì ì¸ ì ‘ê·¼
â€¢ ì†ì¬ì£¼ê°€ ì¢‹ê³  ê¸°ìˆ ì  ëŠ¥ë ¥ ìš°ìˆ˜

**${genderText} ISTPì˜ íŠ¹ë³„í•œ ì :**
${this.chatbotGender === 'female' 
    ? 'â€¢ ë…ë¦½ì„±ê³¼ ì„¬ì„¸í•¨ì˜ ì™„ë²½í•œ ì¡°í™”\nâ€¢ ì°½ì˜ì ì´ë©´ì„œë„ ë…¼ë¦¬ì ì¸ ì‚¬ê³ \nâ€¢ ê°•ì¸í•˜ë©´ì„œë„ ë”°ëœ»í•œ ë¦¬ë”ì‹­' 
    : 'â€¢ ì°¨ë¶„í•œ íŒë‹¨ë ¥ê³¼ ì‹¤í–‰ë ¥\nâ€¢ ê¸°ìˆ ì  ì „ë¬¸ì„±ê³¼ ë¦¬ë”ì‹­\nâ€¢ ì‹¤ìš©ì ì´ë©´ì„œë„ í˜ì‹ ì ì¸ ì‚¬ê³ '
}

ë” êµ¬ì²´ì ì¸ ìƒë‹´ì„ ì›í•˜ì‹ ë‹¤ë©´ ì–¸ì œë“  ìƒˆë¡œìš´ ì§ˆë¬¸ì„ í•´ì£¼ì„¸ìš”! ğŸ˜Šâœ¨`;
            }

            newWish() {
                // ë‹µë³€ ì˜ì—­ ìˆ¨ê¸°ê³  í¸ì§€ì§€ ë‹¤ì‹œ í‘œì‹œ
                document.getElementById('answerSection').style.display = 'none';
                document.getElementById('wishPaper').style.display = 'block';
                document.getElementById('questionInput').value = '';
                
                // í¸ì§€ì§€ë¡œ ìŠ¤í¬ë¡¤
                document.getElementById('wishPaper').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        function sendWish(event) {
            wishService.sendWish(event);
        }

        function newWish() {
            wishService.newWish();
        }

        function goBack() {
            if (confirm('ì •ë§ë¡œ ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = 'gender-selection.html';
            }
        }

        // ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        let wishService;
        document.addEventListener('DOMContentLoaded', () => {
            wishService = new ISTPWishService();
        });

        // í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™”
        document.addEventListener('touchstart', function() {}, {passive: true});
    </script>
</body>
</html>